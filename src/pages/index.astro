---
import BaseLayout from "@/layouts/BaseLayout.astro";
import PostCard from "@/components/PostCard.astro";
import TagPill from "@/components/TagPill.astro";
import { site } from "@/lib/site";
import { buildTagMap, getPublicPosts } from "@/lib/posts";

const posts = await getPublicPosts();
const featured = posts.slice(0, 6);
const tags = buildTagMap(posts).slice(0, 12);
---

<BaseLayout>
  <section class="container-shell mt-8">
    <div class="surface subtle-grid overflow-hidden p-6 md:p-10">
      <div class="grid gap-8 md:grid-cols-[minmax(0,1fr)_240px] md:items-start">
        <div>
          <p class="mb-3 inline-flex items-center rounded-full border border-[color:rgba(54,72,93,0.12)] bg-white/70 px-3 py-1 text-xs tracking-[0.18em] text-[var(--muted)]">
            PERSONAL LOG / BLOG
          </p>
          <h1 class="text-3xl font-semibold leading-tight text-[var(--accent)] md:text-5xl">
            {site.name}
          </h1>
          <p class="mt-3 max-w-2xl text-base leading-8 text-[var(--muted)] md:text-lg">
            {site.tagline}
          </p>
          <p class="mt-5 max-w-2xl text-sm leading-7 text-[var(--muted)]">
            这里记录一些日常思考、技术实践和长期写作过程。节奏不快，但尽量写清楚。
          </p>
        </div>

        <div class="surface bg-white/60 p-4 shadow-none">
          <p class="text-xs uppercase tracking-[0.18em] text-[var(--muted)]">状态</p>
          <ul class="mt-3 space-y-2 text-sm">
            <li class="flex items-center justify-between gap-3">
              <span class="text-[var(--muted)]">公开文章</span>
              <span class="font-medium text-[var(--accent)]">{posts.length}</span>
            </li>
            <li class="flex items-center justify-between gap-3">
              <span class="text-[var(--muted)]">标签</span>
              <span class="font-medium text-[var(--accent)]">{buildTagMap(posts).length}</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  {tags.length > 0 && (
    <section class="container-shell mt-6">
      <div class="surface p-5">
        <div class="mb-4 flex items-center justify-between gap-2">
          <h2 class="text-base font-semibold text-[var(--accent)]">常用标签</h2>
          <a class="text-sm text-[var(--muted)] hover:text-[var(--accent)]" href="/tags">
            查看全部
          </a>
        </div>
        <ul class="flex flex-wrap gap-2">
          {tags.map((tag) => (
            <li>
              <TagPill label={tag.name} count={tag.count} href={`/tags/${encodeURIComponent(tag.name)}/`} />
            </li>
          ))}
        </ul>
      </div>
    </section>
  )}

  <section class="container-shell mt-6">
    <div class="mb-4 flex items-center justify-between gap-4">
      <h2 class="text-lg font-semibold text-[var(--accent)]">最新文章</h2>
      <a class="text-sm text-[var(--muted)] hover:text-[var(--accent)]" href="/archive">
        查看归档
      </a>
    </div>

    {featured.length > 0 ? (
      <div class="grid gap-4">
        {featured.map((post) => <PostCard post={post} />)}
      </div>
    ) : (
      <div class="surface p-8 text-center text-[var(--muted)]">
        还没有公开文章。先在 `src/content/posts` 新建一篇，或者打开 `/keystatic` 开始写。
      </div>
    )}
  </section>
</BaseLayout>
