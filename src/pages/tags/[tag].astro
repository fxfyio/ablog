---
import BaseLayout from "@/layouts/BaseLayout.astro";
import PostCard from "@/components/PostCard.astro";
import { getPublicPosts, normalizeTag } from "@/lib/posts";

export async function getStaticPaths() {
  const posts = await getPublicPosts();
  const tags = [...new Set(posts.flatMap((post) => post.data.tags))];
  return tags.map((tag) => ({
    params: { tag },
    props: { tag }
  }));
}

const { tag } = Astro.props as { tag: string };
const posts = (await getPublicPosts()).filter((post) => post.data.tags.some((item) => normalizeTag(item) === normalizeTag(tag)));
---

<BaseLayout title={`标签：${tag}`}>
  <div class="container-shell mt-8">
    <section class="surface p-6 md:p-8">
      <header class="mb-6 border-b border-[color:rgba(54,72,93,0.08)] pb-4">
        <h1 class="text-3xl font-semibold text-[var(--accent)]">#{tag}</h1>
        <p class="mt-2 text-sm text-[var(--muted)]">{posts.length} 篇文章</p>
      </header>

      <div class="grid gap-4">
        {posts.map((post) => <PostCard post={post} />)}
      </div>
    </section>
  </div>
</BaseLayout>
